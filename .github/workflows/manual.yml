name: Manual workflow

on:
  workflow_dispatch:

jobs:
  xcode-simulators:
    strategy:
      matrix:  
        os: [ macos-15-canary, macos-15-large-canary ]
        xcode-version: [ 16, 16.1, 16.2, 16.3, 16.4 ]
        attempt: [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]

    runs-on: ${{ matrix.os }}

    steps:
      - name: Attempt ${{ matrix.attempt }}
        run: |
            brew install coreutils
            
            sudo xcode-select -s "/Applications/Xcode_${{ matrix.xcode-version }}.app"
            
            TO=$(command -v gtimeout || command -v timeout || true)
            
            $TO 10 xcodebuild -downloadPlatform iOS
            rc=$?
            
            # 124 = сработал таймаут → трактуем как успех
            if [[ $rc -eq 124 ]]; then
              exit 0
            else
              exit $rc
            fi
