name: Manual workflow

on:
  workflow_dispatch:

jobs:
  xcode-simulators:
    strategy:
      matrix:  
        os: [ macos-15-canary, macos-15-large-canary ]
        xcode-version: [ 16, 16.1, 16.2, 16.3, 16.4 ]
        attempt: [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]

    runs-on: ${{ matrix.os }}

    steps:
      - name: Attempt ${{ matrix.attempt }}
        run: |
            sudo xcode-select -s "/Applications/Xcode_${{ matrix.attempt }}.app"
            xcodebuild -downloadPlatform iOS &
            pid=$!

            if ! wait -t 10 $pid 2>/dev/null; then
              kill $pid 2>/dev/null || true
              wait $pid 2>/dev/null || true
              exit 0
            fi
